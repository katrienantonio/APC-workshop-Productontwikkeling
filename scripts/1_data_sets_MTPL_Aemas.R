## ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#install.packages("tidyverse")
#install.packages("AmesHousing")
#install.packages("rstudioapi")
#install.packages("here")
library(tidyverse)
library(AmesHousing)
library(rstudioapi)

dir <- dirname(rstudioapi::getActiveDocumentContext()$path)
setwd(dir)
mtpl_orig <- read.table('../data/PC_data.txt',
                                   header = TRUE)
mtpl_orig <- as_tibble(mtpl_orig)

## -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
str(mtpl_orig)


## -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
head(mtpl_orig) 


## -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
mtpl_orig %>% slice(1:3) %>% select(-LONG, -LAT) 


## -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
mtpl <- mtpl_orig %>%
  # rename all columns 
  rename_all(function(.name) {
    .name %>% 
      # replace all names with the lowercase versions
      tolower 
    # replace all spaces with underscores is also useful, with `str_replace(" ", "-")`
  })
mtpl <- rename(mtpl, expo = exp)

## ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
dim(mtpl)


## ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
mtpl %>% summarize(emp_freq = sum(nclaims) / sum(expo)) 


## ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
mtpl %>% 
  group_by(sex) %>% 
  summarize(emp_freq = sum(nclaims) / sum(expo)) 


## -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
KULbg <- "#116E8A"
g <- ggplot(mtpl, aes(nclaims)) + theme_bw() + 
  geom_bar(aes(weight = expo), col = KULbg, 
           fill = KULbg, alpha = 0.5) + 
  labs(y = "Abs freq (in exposure)") +
  ggtitle("MTPL - number of claims")
g

## -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
g <- ggplot(mtpl, aes(nclaims)) + theme_bw()
g + geom_bar(aes(y = (..count..)/sum(..count..)), 
             col = KULbg, fill = KULbg, alpha = 0.5) + 
  labs(y = "Relative frequency") +
  ggtitle("MTPL - relative number of claims")


## -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
g <- ggplot(mtpl, aes(bm)) + theme_bw()
g + geom_histogram(binwidth = 1, col = KULbg, fill = KULbg, alpha = 0.5)


## -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
g <- ggplot(mtpl, aes(bm)) + theme_bw()
g + geom_histogram(aes(y = (..count..)/sum(..count..)), binwidth = 1, col = KULbg, fill = KULbg, alpha = 0.5) + labs(y = "Relative frequency")


## -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


## -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


## -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
ames <- AmesHousing::make_ames()
ames
